<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>FILM FIND - í•„ë¦„ ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- í°íŠ¸ (Pretendard) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />

  <style>
    :root {
      /* ê¸°ë³¸(ë¼ë²¤ë”) í…Œë§ˆ */
      --bg-gradient: linear-gradient(145deg, #f9fafb, #f4f0ff, #fdf2f8);
      --card-bg: rgba(255,255,255,0.98);
      --card-border: #e3e6ff;
      --shadow-soft: 0 8px 20px rgba(167, 173, 208, 0.35);

      --text-main: #272a3f;
      --text-sub: #767a98;
      --text-muted: #777b9e;
      --label-color: #8689a5;

      --primary-1: #7f9dff;
      --primary-2: #b38cff;
      --primary-soft: rgba(228,231,255,0.95);

      --chip-bg: #f3e8ff;
      --chip-text: #5f308c;

      --danger-bg: #ff6b81;
      --danger-text: #ffffff;

      --pill-bg: rgba(228,231,255,0.98);
      --pill-border: rgba(129, 140, 248, 0.4);

      --toast-bg: rgba(15,23,42,0.9);
      --toast-text: #f9fafb;

      --spinner-border: rgba(191, 219, 254, 0.9);
      --spinner-glow: rgba(129, 140, 248, 0.7);
    }

    /* ë¯¼íŠ¸ í…Œë§ˆ */
    [data-theme="mint"] {
      --bg-gradient: linear-gradient(145deg, #f0fdfa, #e0f2fe, #fefce8);
      --primary-1: #34d399;
      --primary-2: #22c55e;
      --primary-soft: rgba(187,247,208,0.85);
      --chip-bg: #dcfce7;
      --chip-text: #047857;
      --pill-bg: rgba(219, 234, 254, 0.96);
      --pill-border: rgba(45, 212, 191, 0.5);
      --spinner-border: rgba(167, 243, 208, 0.9);
      --spinner-glow: rgba(45, 212, 191, 0.7);
    }

    /* í”¼ì¹˜ í…Œë§ˆ */
    [data-theme="peach"] {
      --bg-gradient: linear-gradient(145deg, #fff7ed, #fee2e2, #fef9c3);
      --primary-1: #fb7185;
      --primary-2: #f97316;
      --primary-soft: rgba(254, 226, 226, 0.9);
      --chip-bg: #ffe4e6;
      --chip-text: #be123c;
      --pill-bg: rgba(254, 226, 226, 0.96);
      --pill-border: rgba(248, 113, 113, 0.55);
      --spinner-border: rgba(254, 202, 202, 0.9);
      --spinner-glow: rgba(248, 113, 113, 0.75);
    }

    /* ë‚˜ì´íŠ¸(ì–´ë‘ìš´) í…Œë§ˆ */
    [data-theme="night"] {
      --bg-gradient: radial-gradient(circle at top, #020617, #020617, #111827);
      --card-bg: rgba(15,23,42,0.98);
      --card-border: #1f2937;
      --shadow-soft: 0 10px 24px rgba(15, 23, 42, 0.75);

      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --text-muted: #9ca3af;
      --label-color: #9ca3af;

      --primary-1: #6366f1;
      --primary-2: #a855f7;
      --primary-soft: rgba(79,70,229,0.22);

      --chip-bg: rgba(79,70,229,0.18);
      --chip-text: #a5b4fc;

      --danger-bg: #f97373;
      --danger-text: #111827;

      --pill-bg: rgba(17,24,39,0.95);
      --pill-border: rgba(129, 140, 248, 0.8);

      --toast-bg: rgba(17,24,39,0.95);
      --toast-text: #e5e7eb;

      --spinner-border: rgba(55, 65, 81, 0.9);
      --spinner-glow: rgba(129, 140, 248, 0.85);
    }

    * {
      box-sizing: border-box;
      font-family: "Pretendard Variable", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg-gradient);
      padding: 12px;
      color: var(--text-main);
    }

    .app-shell {
      max-width: 720px;
      margin: 0 auto;
    }

    /* ìƒë‹¨ í—¤ë” */
    .app-header {
      max-width: 720px;
      margin: 0 auto 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .title-wrap {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .app-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 2px;
      color: var(--text-main);
    }
    .app-subtitle {
      font-size: 11px;
      color: var(--text-sub);
    }
    .device-badge {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 999px;
      background: var(--pill-bg);
      color: var(--text-sub);
      white-space: nowrap;
      max-width: 150px;
      text-overflow: ellipsis;
      overflow: hidden;
      border: 1px solid var(--pill-border);
      box-shadow: 0 0 8px rgba(129, 140, 248, 0.28);
      display: flex;
      align-items: center;
      gap: 4px;
      justify-content: flex-end;
    }
    .device-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--primary-1);
      box-shadow: 0 0 6px rgba(129, 140, 248, 0.9);
    }

    .top-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .top-bar input[type="text"] {
      flex: 1;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      font-size: 14px;
      min-width: 0;
      background: rgba(255,255,255,0.9);
      color: var(--text-main);
    }
    .top-bar input::placeholder {
      color: var(--text-muted);
    }

    [data-theme="night"] .top-bar input[type="text"] {
      background: #020617;
      border-color: #1f2937;
    }

    .btn {
      padding: 8px 11px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
      transition: transform 0.05s ease, box-shadow 0.1s ease, background 0.1s ease, opacity 0.1s ease;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
      opacity: 0.92;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-1), var(--primary-2));
      color: white;
      box-shadow: 0 4px 10px rgba(127,157,255,0.35);
    }
    .btn-secondary {
      background: var(--primary-soft);
      color: #283252;
    }
    [data-theme="night"] .btn-secondary {
      color: #e5e7eb;
    }
    .btn-danger {
      background: var(--danger-bg);
      color: var(--danger-text);
    }
    .btn-small {
      font-size: 12px;
      padding: 5px 9px;
      border-radius: 999px;
    }

    .tools-bar {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    /* ì¹´ìš´íŠ¸ + ë·° ì „í™˜ */
    .count-wrap {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .count-bar {
      font-size: 11px;
      color: var(--text-muted);
      text-align: left;
      flex: 1;
    }
    .count-bar strong {
      color: var(--primary-1);
    }

    .form-card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--card-border);
    }
    .form-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 9px;
    }
    .form-row label {
      font-size: 12px;
      margin-bottom: 4px;
      color: var(--label-color);
    }
    .form-row input[type="text"],
    .form-row input[type="date"],
    .form-row input[type="password"],
    .form-row select {
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid var(--card-border);
      font-size: 13px;
      background: #f9f9ff;
      color: var(--text-main);
    }
    [data-theme="night"] .form-row input[type="text"],
    [data-theme="night"] .form-row input[type="date"],
    [data-theme="night"] .form-row input[type="password"],
    [data-theme="night"] .form-row select {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }
    .form-row input[type="file"] {
      font-size: 12px;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      margin-top: 6px;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 24px;
    }

    /* ê°¤ëŸ¬ë¦¬ ëª¨ë“œ */
    .list.gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
    }
    .list.gallery .card {
      flex-direction: column;
      align-items: stretch;
    }
    .list.gallery .card img {
      width: 100%;
      height: 140px;
    }
@media (max-width: 480px) {
  .list.gallery {
    grid-template-columns: 1fr;
  }
}

    .card {
      background: rgba(255,255,255,0.96);
      border-radius: 16px;
      padding: 10px;
      display: flex;
      gap: 10px;
      box-shadow: 0 6px 16px rgba(169, 177, 214, 0.35);
      align-items: flex-start;
      border: 1px solid var(--card-border);
    }
    [data-theme="night"] .card {
      background: rgba(15,23,42,0.98);
      box-shadow: 0 8px 22px rgba(15,23,42,0.85);
    }

    .card img {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 12px;
      background: #eef1ff;
      flex-shrink: 0;
      cursor: pointer;
    }
    .card-content {
      flex: 1;
      font-size: 13px;
    }
    .card-row-main {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      margin-bottom: 4px;
      align-items: center;
    }
    .card-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-main);
    }
    .card-tag {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: var(--chip-bg);
      color: var(--chip-text);
      align-self: flex-start;
    }
    .card-row {
      margin-bottom: 2px;
      color: var(--text-main);
    }
    .label {
      color: var(--label-color);
      font-size: 11px;
      margin-right: 4px;
    }
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      gap: 6px;
      flex-wrap: wrap;
    }
    .last-used {
      font-size: 11px;
      color: var(--text-muted);
    }
    .card-buttons {
      display: flex;
      gap: 4px;
    }

    .empty-text {
      text-align: center;
      color: #777;
      font-size: 13px;
      margin-top: 20px;
    }

    .toggle-group {
      display: flex;
      gap: 6px;
      margin-bottom: 4px;
      flex-wrap: wrap;
    }
    .toggle-btn {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      background: #f5f3ff;
      color: #464b73;
      cursor: pointer;
      transition: background 0.1s ease, color 0.1s ease, border 0.1s ease;
    }
    .toggle-btn.active {
      border-color: var(--primary-1);
      background: var(--primary-1);
      color: #fff;
    }

    /* ì ê¸ˆ í™”ë©´ */
    .lock-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255,255,255,0.95), rgba(203,213,255,0.96));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 1000;
    }
    .lock-card {
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
      background: rgba(255,255,255,0.98);
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 12px 28px rgba(136, 144, 195, 0.55);
      border: 1px solid #dde1ff;
      text-align: center;
    }
    .lock-title {
      font-size: 18px;
      margin-bottom: 8px;
      font-weight: 600;
      color: #303656;
    }
    .lock-sub {
      font-size: 12px;
      color: #7b7f9d;
      margin-bottom: 14px;
    }
    .lock-input-wrap {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
      align-items: center;
      justify-content: space-between;
    }
    .lock-input-wrap input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d6d9ff;
      background: #f7f7ff;
      text-align: center;
      font-size: 14px;
      letter-spacing: 3px;
      min-width: 0;
    }
    .lock-info {
      font-size: 11px;
      color: #9296b8;
    }

    .settings-section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #3c4266;
    }
    .settings-help {
      font-size: 11px;
      color: #8a8fb0;
      margin-bottom: 6px;
    }

    [data-theme="night"] .settings-section-title {
      color: #e5e7eb;
    }
    [data-theme="night"] .settings-help {
      color: #9ca3af;
    }
    [data-theme="night"] .empty-text {
      color: #9ca3af;
    }

    /* ì´ë¯¸ì§€ ì „ì²´ ë³´ê¸° */
    .image-viewer {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1500;
    }
    .image-viewer-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.75);
    }
    .image-viewer-inner {
      position: relative;
      max-width: 100%;
      max-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    #viewerImage {
      max-width: 100%;
      max-height: 100%;
      border-radius: 12px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.5);
      touch-action: none;
      transition: transform 0.1s ease-out;
    }
    .viewer-close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
      background: rgba(15,23,42,0.8);
      color: #f9fafb;
    }

    /* ê¸°ê¸° ì´ë¦„ ìµœì´ˆ ì…ë ¥ ëª¨ë‹¬ */
    .device-modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1200;
      padding: 16px;
    }
    .device-modal-card {
      background: #fff;
      border-radius: 18px;
      padding: 16px 18px 14px;
      max-width: 320px;
      width: 100%;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    }
    .device-modal-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #272a3f;
    }
    .device-modal-text {
      font-size: 12px;
      color: #767a98;
      margin-bottom: 10px;
    }
    .device-modal-input {
      width: 100%;
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid #d6d9ff;
      font-size: 13px;
      background: #f9f9ff;
      margin-bottom: 10px;
    }
    .device-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    /* í† ìŠ¤íŠ¸ */
    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%) translateY(40px);
      background: var(--toast-bg);
      color: var(--toast-text);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 2000;
      max-width: 80%;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      box-shadow: 0 10px 24px rgba(15,23,42,0.6);
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* íˆìŠ¤í† ë¦¬ íƒ€ì„ë¼ì¸ */
    .history-list {
      max-height: 280px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
      position: relative;
    }
    .history-list::before {
      content: "";
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(to bottom, rgba(148,163,184,0.6), rgba(199,210,254,0.2));
    }
    .history-row {
      font-size: 12px;
      color: #444867;
      padding: 6px 2px 6px 20px;
      position: relative;
    }
    [data-theme="night"] .history-row {
      color: #e5e7eb;
    }
    .history-row::before {
      content: "";
      position: absolute;
      left: 4px;
      top: 10px;
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #fff;
      border: 2px solid var(--primary-1);
      box-shadow: 0 0 0 4px rgba(129,140,248,0.15);
    }
    .history-time {
      color: #6b6f90;
      font-size: 11px;
    }
    [data-theme="night"] .history-time {
      color: #9ca3af;
    }
    .history-device {
      color: var(--primary-1);
      font-size: 11px;
      margin-left: 4px;
    }
    .history-action-chip {
      display: inline-block;
      margin-left: 6px;
      padding: 1px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: var(--chip-bg);
      color: var(--chip-text);
    }
    .history-film {
      color: #111827;
      font-weight: 500;
    }
    [data-theme="night"] .history-film {
      color: #e5e7eb;
    }
    .history-changes {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }
    [data-theme="night"] .history-changes {
      color: #9ca3af;
    }
    .history-empty {
      font-size: 12px;
      color: #6b7280;
      padding-left: 20px;
      margin-top: 6px;
    }
    [data-theme="night"] .history-empty {
      color: #9ca3af;
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .spinner-wrapper {
      display: none;
      justify-content: center;
      align-items: center;
      padding: 4px 0 16px;
    }
    .spinner-wrapper.show {
      display: flex;
    }
    .spinner-circle {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 3px solid var(--spinner-border);
      border-top-color: var(--primary-1);
      box-shadow: 0 0 12px var(--spinner-glow);
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ë§¨ ìœ„ë¡œ ë²„íŠ¼ */
    .scroll-top-btn {
      position: fixed;
      right: 16px;
      bottom: 24px;
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: none;
      font-size: 18px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary-1), var(--primary-2));
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(107,114,128,0.6);
      z-index: 1900;
    }
    .scroll-top-btn.show {
      display: flex;
    }

    @media (min-width: 768px) {
      body {
        padding-top: 24px;
      }
    }
  </style>
</head>
<body>
  <!-- ì ê¸ˆ í™”ë©´ -->
  <div id="lockScreen" class="lock-screen">
    <div class="lock-card">
      <div class="lock-title">FILM FIND ì ê¸ˆ</div>
      <div class="lock-sub">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´<br>íƒ­ì„ ë‹«ê¸° ì „ê¹Œì§€ëŠ” ê³„ì† ì—´ë ¤ ìˆì–´.</div>
      <div class="lock-input-wrap">
        <input type="password" id="passwordInput" maxlength="20" placeholder="â€¢â€¢â€¢â€¢" />
        <button class="btn btn-primary btn-small" id="passwordBtn">ì…ì¥</button>
      </div>
      <div class="lock-info">ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ëŠ” <b>1234</b>ì•¼. ì„¤ì •ì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆì–´.</div>
    </div>
  </div>

  <!-- ê¸°ê¸° ì´ë¦„ ìµœì´ˆ ì…ë ¥ ëª¨ë‹¬ -->
  <div id="deviceModal" class="device-modal">
    <div class="device-modal-card">
      <div class="device-modal-title">ì´ ê¸°ê¸° ì´ë¦„ ì •í•˜ê¸°</div>
      <div class="device-modal-text">
        ì˜ˆ: ê°€ì€í°, ì„±ê·œíŒ¨ë“œ, íšŒì‚¬PC ê°™ì€ ì‹ìœ¼ë¡œ ì ì–´ì¤˜.<br />
        ê¸°ë¡Â·ë™ê¸°í™”í•  ë•Œ ì–´ë””ì—ì„œ ì…ë ¥í–ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ì‰¬ì›Œì ¸.
      </div>
      <input id="deviceModalInput" class="device-modal-input" type="text" placeholder="ì˜ˆ: ê°€ì€í°" />
      <div class="device-modal-actions">
        <button class="btn btn-secondary btn-small" id="deviceModalSkip">ë‚˜ì¤‘ì—</button>
        <button class="btn btn-primary btn-small" id="deviceModalSave">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ì´ë¯¸ì§€ ì „ì²´ë³´ê¸° -->
  <div id="imageViewer" class="image-viewer">
    <div class="image-viewer-backdrop" id="viewerBackdrop"></div>
    <div class="image-viewer-inner">
      <img id="viewerImage" src="" alt="í•„ë¦„ ì´ë¯¸ì§€" />
      <button id="closeViewerBtn" class="viewer-close-btn">âœ•</button>
    </div>
  </div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast" class="toast"></div>

  <!-- ì‹¤ì œ ì•± -->
  <div id="appContainer" style="display:none;">
    <div class="app-header">
      <div class="title-wrap">
        <div class="app-title">FILM FIND</div>
        <div class="app-subtitle">í•„ë¦„ ê´€ë¦¬</div>
      </div>
      <div id="deviceBadge" class="device-badge">
        <span class="device-dot"></span>
        <span id="deviceBadgeText"></span>
      </div>
    </div>

    <div class="app-shell">
      <div class="top-bar">
        <input type="text" id="searchInput" placeholder="ì œí’ˆëª… / í•„ë¦„ë²ˆí˜¸ / ì œíŒíƒ€ì… / ìœ„ì¹˜ / ì œíŒë°©ë²• ê²€ìƒ‰" />
        <button class="btn btn-primary" id="newFilmBtn">+ ìƒˆ í•„ë¦„</button>
      </div>

      <div class="tools-bar">
        <button class="btn btn-secondary btn-small" id="settingsBtn">âš™ ì„¤ì •</button>
        <button class="btn btn-secondary btn-small" id="historyBtn">ğŸ“œ íˆìŠ¤í† ë¦¬</button>
        <button class="btn btn-secondary btn-small" id="exportBtn">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-secondary btn-small" id="importBtn">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="importFile" accept="application/json" style="display:none;" />
      </div>

      <div class="count-wrap">
        <div id="countBar" class="count-bar">ì´ 0ê°œ í•„ë¦„</div>
        <button class="btn btn-secondary btn-small" id="viewToggleBtn">ê°¤ëŸ¬ë¦¬</button>
      </div>

      <!-- ì„¤ì • ì¹´ë“œ -->
      <div class="form-card" id="settingsCard" style="display:none;">
        <div class="form-row">
          <div class="settings-section-title">ì´ ê¸°ê¸° ì´ë¦„</div>
          <div class="settings-help">ì˜ˆ: ê°€ì€í°, ì„±ê·œíŒ¨ë“œ, íšŒì‚¬PC. ì´ ê¸°ê¸°ì—ì„œë§Œ í‘œì‹œë¼.</div>
          <input type="text" id="deviceNameInput" placeholder="ê¸°ê¸° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        </div>
        <div class="form-row">
          <div class="settings-section-title">ê¸°ë³¸ ì •ë ¬ ë°©ì‹</div>
          <div class="settings-help">ë¦¬ìŠ¤íŠ¸ë¥¼ ì–´ë–¤ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í• ì§€ ì„ íƒí•´.</div>
          <select id="sortOptionSelect">
            <option value="updated">ìµœê·¼ ìˆ˜ì •ìˆœ</option>
            <option value="name">ì œí’ˆëª… ê°€ë‚˜ë‹¤ìˆœ</option>
            <option value="number">í•„ë¦„ë²ˆí˜¸ ìˆœ</option>
            <option value="lastUsed">ë§ˆì§€ë§‰ ì‚¬ìš©ì¼ ìµœì‹ ìˆœ</option>
          </select>
        </div>
        <div class="form-row">
          <div class="settings-section-title">í…Œë§ˆ ìƒ‰ìƒ</div>
          <div class="settings-help">ì•±ì˜ ìƒ‰ ë¶„ìœ„ê¸°ë¥¼ ì„ íƒí•´ ì¤˜.</div>
          <select id="themeSelect">
            <option value="default">ë¼ë²¤ë”</option>
            <option value="mint">ë¯¼íŠ¸</option>
            <option value="peach">í”¼ì¹˜</option>
            <option value="night">ë‚˜ì´íŠ¸</option>
          </select>
        </div>
        <div class="form-row">
          <div class="settings-section-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
          <div class="settings-help">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´.</div>
          <input type="password" id="currentPwInput" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" />
          <input type="password" id="newPwInput" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" style="margin-top:6px;" />
          <input type="password" id="newPwConfirmInput" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" style="margin-top:6px;" />
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-small" id="closeSettingsBtn">ë‹«ê¸°</button>
          <button type="button" class="btn btn-primary btn-small" id="saveSettingsBtn">ì €ì¥</button>
        </div>
      </div>

      <!-- íˆìŠ¤í† ë¦¬ ì¹´ë“œ -->
      <div class="form-card" id="historyCard" style="display:none;">
        <div class="settings-section-title">ğŸ“œ íˆìŠ¤í† ë¦¬</div>
        <div class="settings-help">
          ë“±ë¡ / ìˆ˜ì • / ì‚­ì œ / ì˜¤ëŠ˜ ì‚¬ìš© ê¸°ë¡ì„ ìµœê·¼ 100ê°œê¹Œì§€ ë³´ì—¬ì¤„ê²Œ.<br>
          (ê¸°ê¸° ì´ë¦„ê³¼ ì–´ë–¤ í•­ëª©ì´ ë°”ë€Œì—ˆëŠ”ì§€ë„ ê°™ì´ í‘œì‹œë¼.)
        </div>
        <div id="historyList" class="history-list"></div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-small" id="closeHistoryBtn">ë‹«ê¸°</button>
        </div>
      </div>

      <!-- í•„ë¦„ ì…ë ¥ í¼ -->
      <div class="form-card" id="formCard" style="display:none;">
        <form id="filmForm">
          <input type="hidden" id="filmId" />
          <div class="form-row">
            <label for="productName">ì œí’ˆ ì´ë¦„ *</label>
            <input type="text" id="productName" required />
          </div>
          <div class="form-row">
            <label for="filmNumber">í•„ë¦„ ë²ˆí˜¸ *</label>
            <input type="text" id="filmNumber" required />
          </div>
          <div class="form-row">
            <label for="method">ì œíŒ íƒ€ì…</label>
            <input type="text" id="method" placeholder="ì˜ˆ: ë°”íƒ•, ë¬¸ì, ìŠ¤ëª¨ê·¸ ë“±" />
          </div>

          <div class="form-row">
            <label>í•„ë¦„ ì œíŒ ë°©ë²•</label>
            <div class="toggle-group" data-group="frontBack">
              <button type="button" class="toggle-btn" data-value="ì „ë©´">ì „ë©´</button>
              <button type="button" class="toggle-btn" data-value="ë°°ë©´">ë°°ë©´</button>
            </div>
            <div class="toggle-group" data-group="leftRight">
              <button type="button" class="toggle-btn" data-value="ì¢Œ">ì¢Œ</button>
              <button type="button" class="toggle-btn" data-value="ìš°">ìš°</button>
            </div>
            <div class="toggle-group" data-group="upDown">
              <button type="button" class="toggle-btn" data-value="ìƒ">ìƒ</button>
              <button type="button" class="toggle-btn" data-value="í•˜">í•˜</button>
            </div>
            <small style="font-size:11px; color:var(--text-sub);">
              ì „ë©´/ë°°ë©´ + ì¢Œ/ìš° + ìƒ/í•˜ ì¡°í•© (ì˜ˆ: ë°°ë©´ ì¢Œìƒ, ì „ë©´ ìš°í•˜ ë“±)
            </small>
          </div>

          <div class="form-row">
            <label for="location">í•„ë¦„ ìœ„ì¹˜</label>
            <input type="text" id="location" placeholder="ì˜ˆ: A-3 ì„œë, 4ì¸µ ìš°ì¸¡ ë™ ë“±" />
          </div>
          <div class="form-row">
            <label for="lastUsed">ë§ˆì§€ë§‰ ì‚¬ìš©ì¼</label>
            <div style="display:flex; gap:6px;">
              <input type="date" id="lastUsed" style="flex:1;" />
              <button type="button" class="btn btn-secondary btn-small" id="setTodayBtn">ì˜¤ëŠ˜</button>
            </div>
          </div>
          <div class="form-row">
            <label for="imageInput">í•„ë¦„ ì‚¬ì§„ (ì„ íƒ)</label>
            <input type="file" id="imageInput" accept="image/*" />
            <small style="font-size:11px; color:var(--text-sub);">
              Â· ìƒˆ í•„ë¦„ì—ëŠ” ì‚¬ì§„ì„ ì¶”ê°€í•˜ê³ ,<br/>
              Â· ìˆ˜ì • ì‹œ ì‚¬ì§„ì„ ë°”ê¾¸ê³  ì‹¶ì„ ë•Œë§Œ ë‹¤ì‹œ ì„ íƒí•˜ì„¸ìš”.
            </small>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancelBtn">ì·¨ì†Œ</button>
            <button type="submit" class="btn btn-primary" id="saveBtn">ì €ì¥</button>
          </div>
        </form>
      </div>

      <div id="list" class="list"></div>
      <div id="emptyText" class="empty-text" style="display:none;">
        ë“±ë¡ëœ í•„ë¦„ì´ ì—†ìŠµë‹ˆë‹¤.<br/>ì˜¤ë¥¸ìª½ ìœ„ <b>+ ìƒˆ í•„ë¦„</b> ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•˜ì„¸ìš”.
      </div>

      <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ (ë¬´í•œ ìŠ¤í¬ë¡¤ìš©) -->
      <div id="loadingSpinner" class="spinner-wrapper">
        <div class="spinner-circle"></div>
      </div>
    </div>
  </div>

  <!-- ë§¨ ìœ„ë¡œ ë²„íŠ¼ -->
  <button id="scrollTopBtn" class="scroll-top-btn">â†‘</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script>
    /* ---------- Firebase ì„¤ì • ---------- */
    const firebaseConfig = {
      apiKey: "AIzaSyBrBnVuXca2Ou1oMFOLzq3KGEN8xiK5L_U",
      authDomain: "film-find-5242d.firebaseapp.com",
      projectId: "film-find-5242d",
      storageBucket: "film-find-5242d.firebasestorage.app",
      messagingSenderId: "185123433624",
      appId: "1:185123433624:web:269eb9b4b6437887f2f4ed",
      measurementId: "G-V9KL8XS9KJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const FILM_COLLECTION = "films";
    const HISTORY_COLLECTION = "history";

    /* ---------- ì•± ì„¤ì •/í‚¤ ---------- */
    const DEFAULT_PASSWORD = "1234";
    const PASSWORD_KEY = "filmAppPassword";
    const UNLOCK_KEY = "filmAppUnlocked";
    const DEVICE_KEY = "filmDeviceLabel";
    const SORT_KEY = "filmSortOption";
    const THEME_KEY = "filmTheme";
    const VIEW_KEY = "filmViewMode";

    let films = [];
    let currentSearchText = "";
    let unsubscribeFilms = null;

    let historyEntries = [];
    let historyLoaded = false;

    const VISIBLE_STEP = 30;
    let visibleCount = VISIBLE_STEP;
    let loadingMore = false;

    let currentViewMode = localStorage.getItem(VIEW_KEY) || "list";

    /* ---------- ìœ í‹¸ (ì„¤ì •) ---------- */
    function getCurrentPassword() {
      return localStorage.getItem(PASSWORD_KEY) || DEFAULT_PASSWORD;
    }
    function setCurrentPassword(pw) {
      localStorage.setItem(PASSWORD_KEY, pw);
    }
    function getSortOption() {
      return localStorage.getItem(SORT_KEY) || "updated";
    }
    function setSortOption(opt) {
      localStorage.setItem(SORT_KEY, opt);
    }
    function getDeviceLabel() {
      return localStorage.getItem(DEVICE_KEY) || "";
    }
    function setDeviceLabel(label) {
      localStorage.setItem(DEVICE_KEY, label);
      const badgeText = document.getElementById("deviceBadgeText");
      if (badgeText) badgeText.textContent = label || "ê¸°ê¸° ë¯¸ì§€ì •";
    }
    function getTheme() {
      return localStorage.getItem(THEME_KEY) || "default";
    }
    function setTheme(theme) {
      localStorage.setItem(THEME_KEY, theme);
      const root = document.documentElement;
      if (theme === "default") {
        root.removeAttribute("data-theme");
      } else {
        root.setAttribute("data-theme", theme);
      }
    }
    function setViewMode(mode) {
      currentViewMode = mode;
      localStorage.setItem(VIEW_KEY, mode);
      applyViewMode();
    }

    function formatDate(iso) {
      if (!iso) return "-";
      return iso;
    }

    function showToast(msg) {
      const toast = document.getElementById("toast");
      if (!toast) return;
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 1800);
    }

    /* ---------- Firestore ì‹¤ì‹œê°„ ë™ê¸°í™” ---------- */
    function startFilmsListener() {
      if (unsubscribeFilms) {
        unsubscribeFilms();
      }
      unsubscribeFilms = db.collection(FILM_COLLECTION).onSnapshot(
        (snapshot) => {
          films = snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() }));
          if (!currentSearchText && visibleCount < VISIBLE_STEP) {
            visibleCount = Math.min(VISIBLE_STEP, films.length);
          }
          renderList(currentSearchText);
        },
        (error) => {
          console.error("ì‹¤ì‹œê°„ ë™ê¸°í™” ì˜¤ë¥˜:", error);
          showToast("ì„œë²„ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´.");
        }
      );
    }

    /* ---------- íˆìŠ¤í† ë¦¬ ---------- */
    async function addHistory(action, film, changes = []) {
      try {
        const entry = {
          action,
          filmId: film.id || null,
          filmNumber: film.filmNumber || "",
          productName: film.productName || "",
          deviceName: getDeviceLabel() || "",
          timestamp: Date.now(),
          changes,
        };
        await db.collection(HISTORY_COLLECTION).add(entry);
        if (historyLoaded) {
          await loadHistory();
        }
      } catch (e) {
        console.error("íˆìŠ¤í† ë¦¬ ê¸°ë¡ ì¤‘ ì˜¤ë¥˜:", e);
      }
    }

    async function loadHistory() {
      try {
        const snap = await db
          .collection(HISTORY_COLLECTION)
          .orderBy("timestamp", "desc")
          .limit(100)
          .get();
        historyEntries = snap.docs.map((d) => ({ id: d.id, ...d.data() }));
        historyLoaded = true;
        renderHistory();
      } catch (e) {
        console.error("íˆìŠ¤í† ë¦¬ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", e);
        showToast("íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´.");
      }
    }

    function actionLabel(action) {
      if (action === "ë“±ë¡") return "í•„ë¦„ ë“±ë¡";
      if (action === "ìˆ˜ì •") return "í•„ë¦„ ìˆ˜ì •";
      if (action === "ì‚­ì œ") return "í•„ë¦„ ì‚­ì œ";
      if (action === "ì˜¤ëŠ˜ ì‚¬ìš©") return "ì˜¤ëŠ˜ ì‚¬ìš© ì²´í¬";
      return action || "ë³€ê²½";
    }

    function renderHistory() {
      const list = document.getElementById("historyList");
      if (!list) return;
      list.innerHTML = "";

      if (!historyEntries.length) {
        const empty = document.createElement("div");
        empty.className = "history-empty";
        empty.innerHTML = "ì•„ì§ ê¸°ë¡ì´ ì—†ì–´.";
        list.appendChild(empty);
        return;
      }

      historyEntries.forEach((entry) => {
        const row = document.createElement("div");
        row.className = "history-row";

        const d = new Date(entry.timestamp || 0);
        let ts = "";
        if (!isNaN(d.getTime())) {
          const y = d.getFullYear();
          const m = String(d.getMonth() + 1).padStart(2, "0");
          const day = String(d.getDate()).padStart(2, "0");
          const hh = String(d.getHours()).padStart(2, "0");
          const mm = String(d.getMinutes()).padStart(2, "0");
          ts = `${y}-${m}-${day} ${hh}:${mm}`;
        }

        const device = entry.deviceName || "ê¸°ê¸° ë¯¸ì§€ì •";
        const filmLabel =
          (entry.filmNumber || "") +
          (entry.productName ? ` (${entry.productName})` : "");

        const changesArr = Array.isArray(entry.changes) ? entry.changes : [];

        row.innerHTML =
          `<div><span class="history-time">${ts}</span>` +
          `<span class="history-device">${device}</span>` +
          `<span class="history-action-chip">${actionLabel(entry.action)}</span></div>` +
          `<div class="history-film">${filmLabel || "í•„ë¦„ ì •ë³´ ì—†ìŒ"}</div>` +
          (changesArr.length
            ? `<div class="history-changes">ë³€ê²½ í•­ëª©: ${changesArr.join(", ")}</div>`
            : "");

        list.appendChild(row);
      });
    }

    function openHistoryCard() {
      const card = document.getElementById("historyCard");
      const isOpen = card.style.display === "block";
      closeAllPanels();
      if (!isOpen) {
        card.style.display = "block";
        if (!historyLoaded) {
          loadHistory();
        } else {
          renderHistory();
        }
      }
    }
    function closeHistoryCard() {
      document.getElementById("historyCard").style.display = "none";
    }

    /* ---------- ì œíŒ ë°©ë²• í† ê¸€ ---------- */
    function clearPlateInfoForm() {
      document.querySelectorAll(".toggle-btn").forEach((btn) => {
        btn.classList.remove("active");
      });
    }

    function setPlateInfoToForm(str) {
      clearPlateInfoForm();
      if (!str) return;
      const parts = str.split(" ");
      document.querySelectorAll(".toggle-btn").forEach((btn) => {
        if (parts.includes(btn.dataset.value)) {
          btn.classList.add("active");
        }
      });
    }

    function getPlateInfoFromForm() {
      const groups = document.querySelectorAll(".toggle-group");
      const values = [];
      groups.forEach((group) => {
        const active = group.querySelector(".toggle-btn.active");
        if (active) values.push(active.dataset.value);
      });
      return values.join(" ");
    }

    /* ---------- í¼/ë¦¬ìŠ¤íŠ¸ ---------- */
    function resetForm() {
      document.getElementById("filmId").value = "";
      document.getElementById("productName").value = "";
      document.getElementById("filmNumber").value = "";
      document.getElementById("method").value = "";
      document.getElementById("location").value = "";
      document.getElementById("lastUsed").value = "";
      document.getElementById("imageInput").value = "";
      clearPlateInfoForm();
    }

    function getLastFilmForDefaults() {
      if (!films.length) return null;
      return films.reduce((acc, cur) => {
        const a = acc.updatedAt || acc.createdAt || 0;
        const b = cur.updatedAt || cur.createdAt || 0;
        return b > a ? cur : acc;
      });
    }

    function openFormNew() {
      resetForm();
      const last = getLastFilmForDefaults();
      if (last) {
        document.getElementById("method").value = last.method || "";
        document.getElementById("location").value = last.location || "";
        setPlateInfoToForm(last.plateInfo || "");
      }
      document.getElementById("formCard").style.display = "block";
      document.getElementById("productName").focus();
    }

    function toggleFormNew() {
      const card = document.getElementById("formCard");
      const isOpen = card.style.display === "block";
      closeAllPanels();
      if (!isOpen) {
        openFormNew();
      }
    }

    function openFormCopyFrom(id) {
      const film = films.find((f) => f.id === id);
      if (!film) return;
      resetForm();
      document.getElementById("productName").value = film.productName || "";
      document.getElementById("filmNumber").value = "";
      document.getElementById("method").value = film.method || "";
      document.getElementById("location").value = film.location || "";
      document.getElementById("lastUsed").value = "";
      setPlateInfoToForm(film.plateInfo || "");
      closeAllPanels();
      document.getElementById("formCard").style.display = "block";
      document.getElementById("productName").focus();
    }

    function openFormForEdit(id) {
      const film = films.find((f) => f.id === id);
      if (!film) return;
      closeAllPanels();
      document.getElementById("filmId").value = film.id;
      document.getElementById("productName").value = film.productName || "";
      document.getElementById("filmNumber").value = film.filmNumber || "";
      document.getElementById("method").value = film.method || "";
      document.getElementById("location").value = film.location || "";
      document.getElementById("lastUsed").value = film.lastUsed || "";
      document.getElementById("imageInput").value = "";
      setPlateInfoToForm(film.plateInfo || "");
      document.getElementById("formCard").style.display = "block";
      document.getElementById("productName").focus();
    }

    function closeForm() {
      document.getElementById("formCard").style.display = "none";
      resetForm();
    }

    function updateCountBar(filteredLength, totalLength, hasFilter) {
      const bar = document.getElementById("countBar");
      if (!bar) return;
      if (hasFilter) {
        bar.innerHTML = `ê²€ìƒ‰ ê²°ê³¼ <strong>${filteredLength}</strong>ê°œ / ì „ì²´ ${totalLength}ê°œ`;
      } else {
        bar.innerHTML = `ì´ <strong>${totalLength}</strong>ê°œ í•„ë¦„`;
      }
    }

    function renderList(filterText = "") {
      const listEl = document.getElementById("list");
      const emptyText = document.getElementById("emptyText");
      if (!listEl || !emptyText) return;

      listEl.innerHTML = "";
      currentSearchText = filterText || "";

      const text = (filterText || "").trim().toLowerCase();

      let filtered = films.filter((f) => {
        if (!text) return true;
        const combined =
          (f.productName || "") +
          " " +
          (f.filmNumber || "") +
          " " +
          (f.method || "") +
          " " +
          (f.location || "") +
          " " +
          (f.plateInfo || "");
        return combined.toLowerCase().includes(text)
