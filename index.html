Html
<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f9f4ff">
  <meta charset="UTF-8" />
  <title>FILM FIND - í•„ë¦„/íŒ ê´€ë¦¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- í°íŠ¸ (Pretendard) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />

  <style>
    :root {
      --bg-gradient: linear-gradient(145deg, #f9fafb, #f4f0ff, #fdf2f8);
      --card-bg: rgba(255,255,255,0.98);
      --card-border: #e3e6ff;
      --shadow-soft: 0 8px 20px rgba(167, 173, 208, 0.35);

      --text-main: #272a3f;
      --text-sub: #767a98;
      --text-muted: #777b9e;
      --label-color: #8689a5;

      --primary-1: #7f9dff;
      --primary-2: #b38cff;
      --primary-soft: rgba(228,231,255,0.95);

      --chip-bg: #f3e8ff;
      --chip-text: #5f308c;

      --danger-bg: #ff6b81;
      --danger-text: #ffffff;

      --pill-bg: rgba(228,231,255,0.98);
      --pill-border: rgba(129, 140, 248, 0.4);

      --toast-bg: rgba(15,23,42,0.9);
      --toast-text: #f9fafb;

      --spinner-border: rgba(191, 219, 254, 0.9);
      --spinner-glow: rgba(129, 140, 248, 0.7);
    }

    [data-theme="mint"] {
      --bg-gradient: linear-gradient(145deg, #f0fdfa, #e0f2fe, #fefce8);
      --primary-1: #34d399;
      --primary-2: #22c55e;
      --primary-soft: rgba(187,247,208,0.85);
      --chip-bg: #dcfce7;
      --chip-text: #047857;
      --pill-bg: rgba(219, 234, 254, 0.96);
      --pill-border: rgba(45, 212, 191, 0.5);
      --spinner-border: rgba(167, 243, 208, 0.9);
      --spinner-glow: rgba(45, 212, 191, 0.7);
    }

    [data-theme="peach"] {
      --bg-gradient: linear-gradient(145deg, #fff7ed, #fee2e2, #fef9c3);
      --primary-1: #fb7185;
      --primary-2: #f97316;
      --primary-soft: rgba(254, 226, 226, 0.9);
      --chip-bg: #ffe4e6;
      --chip-text: #be123c;
      --pill-bg: rgba(254, 226, 226, 0.96);
      --pill-border: rgba(248, 113, 113, 0.55);
      --spinner-border: rgba(254, 202, 202, 0.9);
      --spinner-glow: rgba(248, 113, 113, 0.75);
    }

    [data-theme="night"] {
      --bg-gradient: radial-gradient(circle at top, #020617, #020617, #111827);
      --card-bg: rgba(15,23,42,0.98);
      --card-border: #1f2937;
      --shadow-soft: 0 10px 24px rgba(15, 23, 42, 0.75);

      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --text-muted: #9ca3af;
      --label-color: #9ca3af;

      --primary-1: #6366f1;
      --primary-2: #a855f7;
      --primary-soft: rgba(79,70,229,0.22);

      --chip-bg: rgba(79,70,229,0.18);
      --chip-text: #a5b4fc;

      --danger-bg: #f97373;
      --danger-text: #111827;

      --pill-bg: rgba(17,24,39,0.95);
      --pill-border: rgba(129, 140, 248, 0.8);

      --toast-bg: rgba(17,24,39,0.95);
      --toast-text: #e5e7eb;

      --spinner-border: rgba(55, 65, 81, 0.9);
      --spinner-glow: rgba(129, 140, 248, 0.85);
    }

    * {
      box-sizing: border-box;
      font-family: "Pretendard Variable", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg-gradient);
      padding: 12px;
      color: var(--text-main);
    }

    .app-shell { max-width: 720px; margin: 0 auto; }

    .app-header {
      max-width: 720px;
      margin: 0 auto 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .title-wrap { display: flex; flex-direction: column; gap: 2px; }
    .app-title { font-size: 20px; font-weight: 700; letter-spacing: 2px; color: var(--text-main); }
    .app-subtitle { font-size: 11px; color: var(--text-sub); }

    .device-badge {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 999px;
      background: var(--pill-bg);
      color: var(--text-sub);
      white-space: nowrap;
      max-width: 190px;
      text-overflow: ellipsis;
      overflow: hidden;
      border: 1px solid var(--pill-border);
      box-shadow: 0 0 8px rgba(129, 140, 248, 0.28);
      display: flex;
      align-items: center;
      gap: 6px;
      justify-content: flex-end;
    }
    .device-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--primary-1);
      box-shadow: 0 0 6px rgba(129, 140, 248, 0.9);
    }
    .mode-badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--chip-bg);
      color: var(--chip-text);
      border: 1px solid var(--card-border);
    }

    .top-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    .top-bar input[type="text"] {
      flex: 1;
      padding: 9px 11px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      font-size: 14px;
      min-width: 0;
      background: rgba(255,255,255,0.9);
      color: var(--text-main);
    }
    .top-bar input::placeholder { color: var(--text-muted); }
    [data-theme="night"] .top-bar input[type="text"] { background: #020617; border-color: #1f2937; }

    .btn {
      padding: 8px 11px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
      transition: transform 0.05s ease, box-shadow 0.1s ease, background 0.1s ease, opacity 0.1s ease;
    }
    .btn:active { transform: translateY(1px); box-shadow: none; opacity: 0.92; }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary-1), var(--primary-2));
      color: white;
      box-shadow: 0 4px 10px rgba(127,157,255,0.35);
    }
    .btn-secondary { background: var(--primary-soft); color: #283252; }
    [data-theme="night"] .btn-secondary { color: #e5e7eb; }
    .btn-danger { background: var(--danger-bg); color: var(--danger-text); }
    .btn-small { font-size: 12px; padding: 5px 9px; border-radius: 999px; }

    .tools-bar {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .count-wrap {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .count-bar { font-size: 11px; color: var(--text-muted); text-align: left; flex: 1; }
    .count-bar strong { color: var(--primary-1); }

    .form-card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 12px 14px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--card-border);
    }
    .form-row { display: flex; flex-direction: column; margin-bottom: 9px; }
    .form-row label { font-size: 12px; margin-bottom: 4px; color: var(--label-color); }
    .form-row input[type="text"],
    .form-row input[type="date"],
    .form-row input[type="password"],
    .form-row input[type="number"],
    .form-row select,
    .form-row textarea {
      padding: 7px 10px;
      border-radius: 10px;
      border: 1px solid var(--card-border);
      font-size: 13px;
      background: #f9f9ff;
      color: var(--text-main);
    }
    .form-row textarea { min-height: 70px; resize: vertical; }
    [data-theme="night"] .form-row input,
    [data-theme="night"] .form-row select,
    [data-theme="night"] .form-row textarea {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
    }

    .form-actions { display: flex; justify-content: flex-end; gap: 6px; margin-top: 6px; }

    .list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 24px; }
    .list.gallery { display: grid; grid-template-columns: 1fr; gap: 12px; }
    .list.gallery .card { flex-direction: column; align-items: stretch; }
    .list.gallery .card img { width: 100%; height: 180px; object-fit: cover; }

    .card {
      background: rgba(255,255,255,0.96);
      border-radius: 16px;
      padding: 10px;
      display: flex;
      gap: 10px;
      box-shadow: 0 6px 16px rgba(169, 177, 214, 0.35);
      align-items: flex-start;
      border: 1px solid var(--card-border);
      animation: cardFadeIn 0.18s ease-out;
    }
    [data-theme="night"] .card { background: rgba(15,23,42,0.98); box-shadow: 0 8px 22px rgba(15,23,42,0.85); }
    @keyframes cardFadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

    .card img {
      width: 70px; height: 70px;
      object-fit: cover;
      border-radius: 12px;
      background: #eef1ff;
      flex-shrink: 0;
      cursor: pointer;
    }
    .card-content { flex: 1; font-size: 13px; }
    .card-row-main { display: flex; justify-content: space-between; gap: 6px; margin-bottom: 4px; align-items: center; }
    .card-title { font-weight: 600; font-size: 14px; color: var(--text-main); }
    .card-tag { font-size: 11px; padding: 3px 7px; border-radius: 999px; background: var(--chip-bg); color: var(--chip-text); align-self: flex-start; }
    .card-row { margin-bottom: 2px; color: var(--text-main); }
    .label { color: var(--label-color); font-size: 11px; margin-right: 4px; }
    .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 6px; gap: 6px; flex-wrap: wrap; }
    .last-used { font-size: 11px; color: var(--text-muted); }
    .card-buttons { display: flex; gap: 4px; flex-wrap: wrap; }

    .empty-text { text-align: center; color: #777; font-size: 13px; margin-top: 20px; }
    [data-theme="night"] .empty-text { color: #9ca3af; }

    .toggle-group { display: flex; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; }
    .toggle-btn {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      background: #f5f3ff;
      color: #464b73;
      cursor: pointer;
      transition: background 0.1s ease, color 0.1s ease, border 0.1s ease;
    }
    .toggle-btn.active { border-color: var(--primary-1); background: var(--primary-1); color: #fff; }

    /* ì ê¸ˆ í™”ë©´ */
    .lock-screen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(255,255,255,0.95), rgba(203,213,255,0.96));
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      z-index: 1000;
    }
    .lock-card {
      width: 100%;
      max-width: 340px;
      margin: 0 auto;
      background: rgba(255,255,255,0.98);
      border-radius: 20px;
      padding: 18px 18px 16px;
      box-shadow: 0 12px 28px rgba(136, 144, 195, 0.55);
      border: 1px solid #dde1ff;
      text-align: center;
    }
    .lock-title { font-size: 18px; margin-bottom: 8px; font-weight: 600; color: #303656; }
    .lock-sub { font-size: 12px; color: #7b7f9d; margin-bottom: 14px; }
    .lock-input-wrap { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; justify-content: space-between; }
    .lock-input-wrap input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #d6d9ff;
      background: #f7f7ff;
      text-align: center;
      font-size: 14px;
      letter-spacing: 3px;
      min-width: 0;
    }
    .lock-info { font-size: 11px; color: #9296b8; line-height: 1.35; }

    /* ì´ë¯¸ì§€ ì „ì²´ ë³´ê¸° */
    .image-viewer { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 1500; }
    .image-viewer-backdrop { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.75); }
    .image-viewer-inner { position: relative; max-width: 100%; max-height: 100%; display: flex; align-items: center; justify-content: center; padding: 16px; }
    #viewerImage { max-width: 100%; max-height: 100%; border-radius: 12px; box-shadow: 0 16px 40px rgba(0,0,0,0.5); touch-action: none; transition: transform 0.1s ease-out; }
    .viewer-close-btn { position: absolute; top: 16px; right: 16px; border-radius: 999px; border: none; padding: 6px 10px; font-size: 14px; cursor: pointer; background: rgba(15,23,42,0.8); color: #f9fafb; }

    /* í† ìŠ¤íŠ¸ */
    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%) translateY(40px);
      background: var(--toast-bg);
      color: var(--toast-text);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 2000;
      max-width: 80%;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      box-shadow: 0 10px 24px rgba(15,23,42,0.6);
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* íˆìŠ¤í† ë¦¬ íƒ€ì„ë¼ì¸ */
    .history-list { max-height: 280px; overflow-y: auto; padding-right: 4px; margin-top: 4px; position: relative; }
    .history-list::before { content: ""; position: absolute; left: 8px; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, rgba(148,163,184,0.6), rgba(199,210,254,0.2)); }
    .history-row { font-size: 12px; color: #444867; padding: 6px 2px 6px 20px; position: relative; }
    [data-theme="night"] .history-row { color: #e5e7eb; }
    .history-row::before { content: ""; position: absolute; left: 4px; top: 10px; width: 8px; height: 8px; border-radius: 999px; background: #fff; border: 2px solid var(--primary-1); box-shadow: 0 0 0 4px rgba(129,140,248,0.15); }
    .history-time { color: #6b6f90; font-size: 11px; }
    [data-theme="night"] .history-time { color: #9ca3af; }
    .history-device { color: var(--primary-1); font-size: 11px; margin-left: 4px; }
    .history-action-chip { display: inline-block; margin-left: 6px; padding: 1px 6px; border-radius: 999px; font-size: 11px; background: var(--chip-bg); color: var(--chip-text); }
    .history-film { color: #111827; font-weight: 500; }
    [data-theme="night"] .history-film { color: #e5e7eb; }
    .history-changes { font-size: 11px; color: #6b7280; margin-top: 2px; }
    [data-theme="night"] .history-changes { color: #9ca3af; }
    .history-empty { font-size: 12px; color: #6b7280; padding-left: 20px; margin-top: 6px; }
    [data-theme="night"] .history-empty { color: #9ca3af; }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .spinner-wrapper { display: none; justify-content: center; align-items: center; padding: 4px 0 16px; }
    .spinner-wrapper.show { display: flex; }
    .spinner-circle {
      width: 28px; height: 28px;
      border-radius: 999px;
      border: 3px solid var(--spinner-border);
      border-top-color: var(--primary-1);
      box-shadow: 0 0 12px var(--spinner-glow);
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ë§¨ ìœ„ë¡œ ë²„íŠ¼ */
    .scroll-top-btn {
      position: fixed;
      right: 16px;
      bottom: 24px;
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: none;
      font-size: 18px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary-1), var(--primary-2));
      color: #fff;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(107,114,128,0.6);
      z-index: 1900;
    }
    .scroll-top-btn.show { display: flex; }

    @media (min-width: 768px) { body { padding-top: 24px; } }
    @media (min-width: 600px) { .list.gallery { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (min-width: 1024px) {
      .app-shell, .app-header { max-width: 1080px; }
      .list.gallery { grid-template-columns: repeat(3, minmax(260px, 1fr)); }
    }

    /* ====== ë©”ëª¨: ë°”í…€ ì‹œíŠ¸ ====== */
    .memo-sheet { position: fixed; inset: 0; display: none; align-items: flex-end; justify-content: center; z-index: 1600; }
    .memo-sheet.show { display: flex; }
    .memo-sheet-backdrop { position: absolute; inset: 0; background: rgba(15, 23, 42, 0.45); }
    .memo-sheet-panel {
      position: relative;
      width: 100%;
      max-width: 720px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px 18px 0 0;
      box-shadow: 0 -12px 28px rgba(0,0,0,0.25);
      padding: 12px 14px 14px;
      animation: sheetUp 0.16s ease-out;
    }
    @keyframes sheetUp { from { transform: translateY(14px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .memo-sheet-head { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
    .memo-sheet-title { font-size: 14px; font-weight: 700; color: var(--text-main); }
    .memo-sheet-sub { font-size: 11px; color: var(--text-sub); margin-top: 2px; }
    .memo-sheet-textarea {
      width: 100%;
      min-height: 120px;
      resize: vertical;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: #f9f9ff;
      color: var(--text-main);
      font-size: 13px;
      line-height: 1.45;
    }
    [data-theme="night"] .memo-sheet-textarea { background: #020617; border-color: #1f2937; color: #e5e7eb; }
    .memo-sheet-actions { display: flex; justify-content: flex-end; gap: 6px; margin-top: 10px; }
    .btn-memo-has { box-shadow: 0 0 0 2px rgba(127,157,255,0.18) inset; }

    /* ====== íˆìŠ¤í† ë¦¬ ë©”ëª¨ ====== */
    .history-headline { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .history-pencil {
      border: none;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: var(--primary-soft);
      color: var(--text-main);
    }
    [data-theme="night"] .history-pencil { color: #e5e7eb; }
    .history-note {
      margin-top: 6px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: rgba(228,231,255,0.65);
      font-size: 12px;
      color: var(--text-main);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    [data-theme="night"] .history-note { background: rgba(79,70,229,0.18); border-color: #1f2937; }

    .note-modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1700;
      padding: 16px;
    }
    .note-modal.show { display: flex; }
    .note-modal-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      padding: 16px 18px 14px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    }
    .note-modal-title { font-size: 15px; font-weight: 700; margin-bottom: 6px; color: var(--text-main); }
    .note-modal-text { font-size: 12px; color: var(--text-sub); margin-bottom: 10px; }
    .note-modal-textarea {
      width: 100%;
      min-height: 120px;
      resize: vertical;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: #f9f9ff;
      color: var(--text-main);
      font-size: 13px;
      line-height: 1.45;
    }
    [data-theme="night"] .note-modal-textarea { background: #020617; border-color: #1f2937; color: #e5e7eb; }
    .note-modal-actions { display: flex; justify-content: flex-end; gap: 6px; margin-top: 10px; }

    /* ====== íŒ ëª¨ë‹¬(ìˆ˜ëŸ‰ ë“±ë¡/íˆìŠ¤í† ë¦¬) ====== */
    .plate-modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1750;
      padding: 16px;
    }
    .plate-modal.show { display: flex; }
    .plate-modal-card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      padding: 14px 14px 12px;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    }
    .plate-modal-head { display: flex; align-items: flex-start; justify-content: space-between; gap: 10px; margin-bottom: 8px; }
    .plate-modal-title { font-size: 15px; font-weight: 800; color: var(--text-main); }
    .plate-modal-sub { font-size: 12px; color: var(--text-sub); margin-top: 2px; }
    .plate-stats {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: rgba(228,231,255,0.55);
      color: var(--text-main);
      margin-bottom: 10px;
    }
    [data-theme="night"] .plate-stats { background: rgba(79,70,229,0.18); border-color: #1f2937; }
    .warn { color: #b45309; font-weight: 700; }
    .over { color: #e11d48; font-weight: 900; }

    .pill-row { display:flex; gap:6px; flex-wrap:wrap; align-items:center; margin-top:4px; }
    .mini-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--card-border);
      background: rgba(255,255,255,0.7);
      color: var(--text-sub);
    }
    [data-theme="night"] .mini-pill { background: rgba(2,6,23,0.9); border-color: #1f2937; }

    .divider { height: 1px; background: rgba(148,163,184,0.35); margin: 10px 0; }

  </style>
</head>
<body>
  <!-- ì ê¸ˆ í™”ë©´ -->
  <div id="lockScreen" class="lock-screen">
    <div class="lock-card">
      <div class="lock-title">FILM FIND ì ê¸ˆ</div>
      <div class="lock-sub">
        ë¹„ë°€ë²ˆí˜¸ë¡œ ëª¨ë“œë¥¼ ì„ íƒí•´.<br>
        íƒ­ì„ ë‹«ê¸° ì „ê¹Œì§€ëŠ” ê³„ì† ì—´ë ¤ ìˆì–´.
      </div>
      <div class="lock-input-wrap">
        <input type="password" id="passwordInput" maxlength="20" placeholder="â€¢â€¢â€¢â€¢" />
        <button class="btn btn-primary btn-small" id="passwordBtn">ì…ì¥</button>
      </div>
      <div class="lock-info">
        <b>ê´€ë¦¬ì</b> : <b>0605</b><br>
        <b>ì¸ì‡„ê¸°ì‚¬</b> : <b>1234</b><br>
        (ì„¤ì •ì—ì„œ ë³€ê²½ ê°€ëŠ¥)
      </div>
    </div>
  </div>

  <!-- ì´ë¯¸ì§€ ì „ì²´ë³´ê¸° -->
  <div id="imageViewer" class="image-viewer">
    <div class="image-viewer-backdrop" id="viewerBackdrop"></div>
    <div class="image-viewer-inner">
      <img id="viewerImage" src="" alt="í•„ë¦„ ì´ë¯¸ì§€" />
      <button id="closeViewerBtn" class="viewer-close-btn">âœ•</button>
    </div>
  </div>

  <!-- í† ìŠ¤íŠ¸ -->
  <div id="toast" class="toast"></div>

  <!-- ====== í•„ë¦„ ë©”ëª¨ ìŠ¬ë¼ì´ë“œ ====== -->
  <div id="memoSheet" class="memo-sheet">
    <div id="memoSheetBackdrop" class="memo-sheet-backdrop"></div>
    <div class="memo-sheet-panel">
      <div class="memo-sheet-head">
        <div>
          <div class="memo-sheet-title" id="memoSheetTitle">ë©”ëª¨</div>
          <div class="memo-sheet-sub" id="memoSheetSub">í•„ë¦„ë³„ ë©”ëª¨ë¥¼ ì ê³  ì €ì¥í•  ìˆ˜ ìˆì–´.</div>
        </div>
        <button class="btn btn-secondary btn-small" id="memoSheetCloseBtn">ë‹«ê¸°</button>
      </div>
      <textarea id="memoTextarea" class="memo-sheet-textarea" placeholder="ì˜ˆ: í…ì…˜ 23 ì´í•˜ì—ì„œ ë²ˆì§ / ìš°ì¸¡ 2mm ë°€ë¦¼ ì£¼ì˜"></textarea>
      <div class="memo-sheet-actions">
        <button class="btn btn-secondary btn-small" id="memoSheetCancelBtn">ì·¨ì†Œ</button>
        <button class="btn btn-primary btn-small" id="memoSheetSaveBtn">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ====== íˆìŠ¤í† ë¦¬ ë©”ëª¨ ëª¨ë‹¬ ====== -->
  <div id="historyNoteModal" class="note-modal">
    <div class="note-modal-card">
      <div class="note-modal-title">íˆìŠ¤í† ë¦¬ ë©”ëª¨</div>
      <div class="note-modal-text">ì´ ë³€ê²½ ê¸°ë¡ì— â€œì™œ ë°”ë€Œì—ˆëŠ”ì§€â€ë¥¼ ì ì–´ë‘˜ ìˆ˜ ìˆì–´.</div>
      <textarea id="historyNoteTextarea" class="note-modal-textarea" placeholder="ì˜ˆ: ê²¹ì¹¨ ì´ìŠˆë¡œ 4-2-1.6ë²ˆìœ¼ë¡œ ì´ë™"></textarea>
      <div class="note-modal-actions">
        <button class="btn btn-secondary btn-small" id="historyNoteCancelBtn">ì·¨ì†Œ</button>
        <button class="btn btn-primary btn-small" id="historyNoteSaveBtn">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- ====== íŒ ëª¨ë‹¬: ìˆ˜ëŸ‰ ë“±ë¡ + íŒ íˆìŠ¤í† ë¦¬ ====== -->
  <div id="plateModal" class="plate-modal">
    <div class="plate-modal-card">
      <div class="plate-modal-head">
        <div>
          <div class="plate-modal-title" id="plateModalTitle">íŒ</div>
          <div class="plate-modal-sub" id="plateModalSub">ì œí’ˆëª…</div>
          <div class="pill-row">
            <span class="mini-pill" id="plateModalFilmNo">í•„ë¦„</span>
            <span class="mini-pill" id="plateModalPlateNo">íŒ</span>
            <span class="mini-pill" id="plateModalStatus">ìƒíƒœ</span>
          </div>
        </div>
        <button class="btn btn-secondary btn-small" id="plateModalCloseBtn">ë‹«ê¸°</button>
      </div>

      <div id="plateModalStats" class="plate-stats">-</div>

      <div id="plateRegisterSection" class="form-card" style="padding:10px 12px; margin-bottom:10px;">
        <div class="form-row">
          <label>ì¸ì‡„ê¸°ì‚¬ ì´ë¦„</label>
          <select id="platePrinterSelect"></select>
        </div>
        <div class="form-row">
          <label>ì¸ì‡„ ìˆ˜ëŸ‰ *</label>
          <input type="number" id="plateQtyInput" min="1" step="1" placeholder="ì˜ˆ: 500" />
        </div>
        <div class="form-row">
          <label>ë©”ëª¨(ì„ íƒ)</label>
          <input type="text" id="plateLogNoteInput" placeholder="ì˜ˆ: 2ìƒ‰ / 1ì°¨ë§Œ" />
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary btn-small" id="plateRegisterCancelBtn">ì·¨ì†Œ</button>
          <button class="btn btn-primary btn-small" id="plateRegisterSaveBtn">ë“±ë¡</button>
        </div>
      </div>

      <div class="settings-section-title" style="margin-bottom:6px;">íŒ íˆìŠ¤í† ë¦¬</div>
      <div id="plateHistoryList" class="history-list" style="max-height:240px;"></div>

      <div id="plateAdminActions" style="display:none; margin-top:10px;">
        <div class="divider"></div>
        <div class="settings-section-title" style="margin-bottom:6px;">ê´€ë¦¬ì ì‘ì—…</div>
        <div class="form-row">
          <label>ìµœëŒ€ ì œí’ˆ ê°œìˆ˜(íŒ ìˆ˜ëª…) ìˆ˜ì •</label>
          <input type="number" id="plateMaxEditInput" min="1" step="1" placeholder="ì˜ˆ: 3000" />
        </div>
        <div class="form-actions" style="justify-content:space-between;">
          <button class="btn btn-danger btn-small" id="plateTrashBtn">íœ´ì§€í†µìœ¼ë¡œ</button>
          <div style="display:flex; gap:6px;">
            <button class="btn btn-secondary btn-small" id="plateDiscardBtn">íê¸° ì²˜ë¦¬</button>
            <button class="btn btn-primary btn-small" id="plateMaxSaveBtn">ì €ì¥</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì‹¤ì œ ì•± -->
  <div id="appContainer" style="display:none;">
    <div class="app-header">
      <div class="title-wrap">
        <div class="app-title">FILM FIND</div>
        <div class="app-subtitle" id="subtitleText">í•„ë¦„ ê´€ë¦¬</div>
      </div>
      <div id="deviceBadge" class="device-badge">
        <span class="device-dot"></span>
        <span id="deviceBadgeText"></span>
        <span class="mode-badge" id="modeBadge">MODE</span>
      </div>
    </div>

    <div class="app-shell">
      <div class="top-bar">
        <input type="text" id="searchInput" placeholder="(ê´€ë¦¬ì) ì œí’ˆëª…/í•„ë¦„ë²ˆí˜¸/ìœ„ì¹˜...  |  (ì¸ì‡„ê¸°ì‚¬) ì œí’ˆëª…/íŒë²ˆí˜¸ ê²€ìƒ‰" />
        <button class="btn btn-primary" id="newFilmBtn">+ ìƒˆ í•„ë¦„</button>
      </div>

      <div class="tools-bar">
        <button class="btn btn-secondary btn-small" id="settingsBtn">âš™ ì„¤ì •</button>
        <button class="btn btn-secondary btn-small" id="historyBtn">ğŸ“œ íˆìŠ¤í† ë¦¬</button>
        <button class="btn btn-secondary btn-small" id="trashBtn">ğŸ—‘ íŒ íœ´ì§€í†µ</button>
        <button class="btn btn-secondary btn-small" id="exportBtn">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-secondary btn-small" id="importBtn">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <input type="file" id="importFile" accept="application/json" style="display:none;" />
      </div>

      <div class="count-wrap">
        <div id="countBar" class="count-bar">ì´ 0ê°œ</div>
        <button class="btn btn-secondary btn-small" id="viewToggleBtn">ê°¤ëŸ¬ë¦¬</button>
      </div>

      <!-- ì„¤ì • ì¹´ë“œ -->
      <div class="form-card" id="settingsCard" style="display:none;">
        <div class="form-row">
          <div class="settings-section-title">ê¸°ê¸° ì´ë¦„</div>
          <div class="settings-help">ì˜ˆ: ê°€ì€í°, ì„±ê·œíŒ¨ë“œ, íšŒì‚¬PC</div>
          <input type="text" id="deviceNameInput" placeholder="ê¸°ê¸° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
        </div>

        <div class="form-row">
          <div class="settings-section-title">í…Œë§ˆ ìƒ‰ìƒ</div>
          <div class="settings-help">ì•±ì˜ ìƒ‰ ë¶„ìœ„ê¸°ë¥¼ ì„ íƒí•´ ì¤˜.</div>
          <select id="themeSelect">
            <option value="default">ë¼ë²¤ë”</option>
            <option value="mint">ë¯¼íŠ¸</option>
            <option value="peach">í”¼ì¹˜</option>
            <option value="night">ë‚˜ì´íŠ¸</option>
          </select>
        </div>

        <div class="form-row">
          <div class="settings-section-title">ê¸°ë³¸ ì •ë ¬ ë°©ì‹(ê´€ë¦¬ì í•„ë¦„ ë¦¬ìŠ¤íŠ¸)</div>
          <select id="sortOptionSelect">
            <option value="updated">ìµœê·¼ ìˆ˜ì •ìˆœ</option>
            <option value="name">ì œí’ˆëª… ê°€ë‚˜ë‹¤ìˆœ</option>
            <option value="number">í•„ë¦„ë²ˆí˜¸ ìˆœ</option>
            <option value="lastUsed">ë§ˆì§€ë§‰ ì‚¬ìš©ì¼ ìµœì‹ ìˆœ</option>
          </select>
        </div>

        <div class="form-row">
          <div class="settings-section-title">ëª¨ë“œ ë¹„ë°€ë²ˆí˜¸</div>
          <div class="settings-help">0605(ê´€ë¦¬ì) / 1234(ì¸ì‡„ê¸°ì‚¬) ê¸°ë³¸ê°’. ì›í•˜ë©´ ë³€ê²½ ê°€ëŠ¥.</div>
          <input type="password" id="adminPinInput" placeholder="ê´€ë¦¬ì ë¹„ë²ˆ(ì˜ˆ: 0605)" />
          <input type="password" id="printerPinInput" placeholder="ì¸ì‡„ê¸°ì‚¬ ë¹„ë²ˆ(ì˜ˆ: 1234)" style="margin-top:6px;" />
          <small style="font-size:11px; color:var(--text-sub);">
            Â· ë„ˆë¬´ ì§§ìœ¼ë©´(4ì ë¯¸ë§Œ) ì €ì¥ ì•ˆ ë¨<br>
            Â· ë°”ê¾¸ë©´ ë‹¤ìŒ ë¡œê·¸ì¸ë¶€í„° ì ìš©
          </small>
        </div>

        <div class="form-row">
          <div class="settings-section-title">ìƒˆ íŒ ê¸°ë³¸ ìµœëŒ€ìˆ˜ëŸ‰</div>
          <div class="settings-help">íŒì„ ìƒˆë¡œ ë§Œë“¤ ë•Œ ìë™ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” ê¸°ë³¸ê°’(ê´€ë¦¬ìë§Œ ì˜ë¯¸ ìˆìŒ)</div>
          <input type="number" id="defaultPlateMaxInput" min="1" step="1" placeholder="ì˜ˆ: 3000" />
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-small" id="closeSettingsBtn">ë‹«ê¸°</button>
          <button type="button" class="btn btn-primary btn-small" id="saveSettingsBtn">ì €ì¥</button>
        </div>
      </div>

      <!-- íˆìŠ¤í† ë¦¬ ì¹´ë“œ(í•„ë¦„ ë³€ê²½ ê¸°ë¡) -->
      <div class="form-card" id="historyCard" style="display:none;">
        <div class="settings-section-title">ğŸ“œ íˆìŠ¤í† ë¦¬(í•„ë¦„)</div>
        <div class="settings-help">
          ë“±ë¡ / ìˆ˜ì • / ì‚­ì œ / ì˜¤ëŠ˜ ì‚¬ìš© ê¸°ë¡ (ìµœê·¼ 100ê°œ)
        </div>
        <div id="historyList" class="history-list"></div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-small" id="closeHistoryBtn">ë‹«ê¸°</button>
        </div>
      </div>

      <!-- íŒ íœ´ì§€í†µ ì¹´ë“œ -->
      <div class="form-card" id="trashCard" style="display:none;">
        <div class="settings-section-title">ğŸ—‘ íŒ íœ´ì§€í†µ</div>
        <div class="settings-help">
          íœ´ì§€í†µì— ë“¤ì–´ê°„ íŒì€ <b>30ì¼</b> ë’¤ ìë™ ì‚­ì œë¼.<br>
          (ìë™ ì‚­ì œëŠ” ì•±ì´ ì—´ë¦´ ë•Œ/íœ´ì§€í†µ ì—´ ë•Œ ì •ë¦¬ë¼)
        </div>
        <div id="trashList" class="list" style="margin-bottom:10px;"></div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary btn-small" id="closeTrashBtn">ë‹«ê¸°</button>
        </div>
      </div>

      <!-- í•„ë¦„ ì…ë ¥ í¼(ê´€ë¦¬ì ì „ìš©) -->
      <div class="form-card" id="formCard" style="display:none;">
        <form id="filmForm">
          <input type="hidden" id="filmId" />
          <div class="form-row">
            <label for="productName">ì œí’ˆ ì´ë¦„ *</label>
            <input type="text" id="productName" required />
          </div>
          <div class="form-row">
            <label for="filmNumber">í•„ë¦„ ë²ˆí˜¸ *</label>
            <input type="text" id="filmNumber" required />
          </div>
          <div class="form-row">
            <label for="method">ì œíŒ íƒ€ì…</label>
            <input type="text" id="method" placeholder="ì˜ˆ: ë°”íƒ•, ë¬¸ì, ìŠ¤ëª¨ê·¸ ë“±" />
          </div>

          <div class="form-row">
            <label for="mesh">MESH</label>
            <input type="text" id="mesh" placeholder="ì˜ˆ: 180T, 200ë©”ì‰¬ ë“±" />
          </div>

          <div class="form-row">
            <label>í•„ë¦„ ì œíŒ ë°©ë²•</label>
            <div class="toggle-group" data-group="frontBack">
              <button type="button" class="toggle-btn" data-value="ì „ë©´">ì „ë©´</button>
              <button type="button" class="toggle-btn" data-value="ë°°ë©´">ë°°ë©´</button>
            </div>
            <div class="toggle-group" data-group="leftRight">
              <button type="button" class="toggle-btn" data-value="ì¢Œ">ì¢Œ</button>
              <button type="button" class="toggle-btn" data-value="ìš°">ìš°</button>
            </div>
            <div class="toggle-group" data-group="upDown">
              <button type="button" class="toggle-btn" data-value="ìƒ">ìƒ</button>
              <button type="button" class="toggle-btn" data-value="í•˜">í•˜</button>
            </div>
            <small style="font-size:11px; color:var(--text-sub);">
              ì „ë©´/ë°°ë©´ + ì¢Œ/ìš° + ìƒ/í•˜ ì¡°í•©
            </small>
          </div>

          <div class="form-row">
            <label for="location">í•„ë¦„ ìœ„ì¹˜</label>
            <input type="text" id="location" placeholder="ì˜ˆ: A-3 ì„œë, 4ì¸µ ìš°ì¸¡ ë™ ë“±" />
          </div>

          <div class="form-row">
            <label for="requestPrinter">ìš”ì²­ ì¸ì‡„ì</label>
            <select id="requestPrinter"></select>
          </div>

          <div class="form-row">
            <label for="etc">ê¸°íƒ€(ì„ íƒ)</label>
            <input type="text" id="etc" placeholder="ì˜ˆ: ì£¼ì˜ì‚¬í•­/íŠ¹ì´ì‚¬í•­" />
          </div>

          <div class="form-row">
            <label for="lastUsed">ë§ˆì§€ë§‰ ì‚¬ìš©ì¼</label>
            <div style="display:flex; gap:6px;">
              <input type="date" id="lastUsed" style="flex:1;" />
              <button type="button" class="btn btn-secondary btn-small" id="setTodayBtn">ì˜¤ëŠ˜</button>
            </div>
          </div>

          <div class="form-row">
            <label for="imageInput">í•„ë¦„ ì‚¬ì§„ (ì„ íƒ)</label>
            <input type="file" id="imageInput" accept="image/*" />
            <small style="font-size:11px; color:var(--text-sub);">
              Â· ìƒˆ í•„ë¦„ì—ëŠ” ì‚¬ì§„ ì¶”ê°€ ê°€ëŠ¥<br/>
              Â· ìˆ˜ì • ì‹œ ì‚¬ì§„ ë°”ê¿€ ë•Œë§Œ ë‹¤ì‹œ ì„ íƒ
            </small>

            <div id="imagePreviewWrapper" style="margin-top:8px; display:none; align-items:center; gap:6px;">
              <img id="imagePreview" alt="ë¯¸ë¦¬ë³´ê¸°"
                   style="width:70px; height:70px; border-radius:10px; object-fit:cover; background:#eef1ff;" />
              <button type="button" class="btn btn-secondary btn-small" id="rotateLeftBtn">âŸ² 90Â°</button>
              <button type="button" class="btn btn-secondary btn-small" id="rotateRightBtn">âŸ³ 90Â°</button>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="cancelBtn">ì·¨ì†Œ</button>
            <button type="submit" class="btn btn-primary" id="saveBtn">ì €ì¥</button>
          </div>

          <div style="margin-top:10px; font-size:11px; color:var(--text-sub);">
            âœ… ìƒˆ í•„ë¦„ ë“±ë¡ ì‹œ <b>ì²« ë²ˆì§¸ íŒ(í•„ë¦„ë²ˆí˜¸-1)</b>ì´ ìë™ ìƒì„±ë¼.<br>
            (ê¸°ë³¸ ìµœëŒ€ìˆ˜ëŸ‰ì€ ì„¤ì •ì˜ â€œìƒˆ íŒ ê¸°ë³¸ ìµœëŒ€ìˆ˜ëŸ‰â€ ì‚¬ìš©)
          </div>
        </form>
      </div>

      <!-- ë¦¬ìŠ¤íŠ¸ -->
      <div id="list" class="list"></div>
      <div id="emptyText" class="empty-text" style="display:none;"></div>

      <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
      <div id="loadingSpinner" class="spinner-wrapper">
        <div class="spinner-circle"></div>
      </div>
    </div>
  </div>

  <!-- ë§¨ ìœ„ë¡œ ë²„íŠ¼ -->
  <button id="scrollTopBtn" class="scroll-top-btn">â†‘</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>

  <script>
    /* ---------- Firebase ì„¤ì • ---------- */
    const firebaseConfig = {
      apiKey: "AIzaSyBrBnVuXca2Ou1oMFOLzq3KGEN8xiK5L_U",
      authDomain: "film-find-5242d.firebaseapp.com",
      projectId: "film-find-5242d",
      storageBucket: "film-find-5242d.firebasestorage.app",
      messagingSenderId: "185123433624",
      appId: "1:185123433624:web:269eb9b4b6437887f2f4ed",
      measurementId: "G-V9KL8XS9KJ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const FILM_COLLECTION = "films";
    const HISTORY_COLLECTION = "history";

    /* âœ… ì¶”ê°€ ì»¬ë ‰ì…˜ */
    const PLATE_COLLECTION = "plates";
    const PLATE_LOG_COLLECTION = "plateLogs";

    /* ---------- ì•± ì„¤ì •/í‚¤ ---------- */
    const UNLOCK_KEY = "filmAppUnlocked";
    const ROLE_KEY = "filmAppRole";
    const DEVICE_KEY = "filmDeviceLabel";
    const SORT_KEY = "filmSortOption";
    const THEME_KEY = "filmTheme";
    const VIEW_KEY = "filmViewMode";

    /* âœ… ë¹„ë²ˆ 2ê°œ */
    const ADMIN_PIN_KEY = "filmAdminPin";
    const PRINTER_PIN_KEY = "filmPrinterPin";
    const DEFAULT_ADMIN_PIN = "0605";
    const DEFAULT_PRINTER_PIN = "1234";

    /* âœ… ìƒˆ íŒ ê¸°ë³¸ ìµœëŒ€ìˆ˜ëŸ‰ */
    const DEFAULT_PLATE_MAX_KEY = "filmDefaultPlateMax";
    const DEFAULT_PLATE_MAX_FALLBACK = 3000;

    let currentRole = "admin"; // 'admin' | 'printer'
    let films = [];
    let plates = [];
    let currentSearchText = "";
    let unsubscribeFilms = null;
    let unsubscribePlates = null;

    let historyEntries = [];
    let historyLoaded = false;

    const VISIBLE_STEP = 30;
    let visibleCount = VISIBLE_STEP;
    let loadingMore = false;

    let currentViewMode = localStorage.getItem(VIEW_KEY) || "list";

    let currentSelectedImageDataUrl = null;
    let currentImageRotation = 0;

    let currentMemoFilmId = null;
    let currentHistoryNoteId = null;

    /* âœ… íŒ ëª¨ë‹¬ ìƒíƒœ */
    let currentPlateId = null;

    const PRINTER_OPTIONS = [
      "", "ì´ì°½ë¯¼ ë¶€ì¥ë‹˜", "ê³ ê´‘ìš´ ê³¼ì¥ë‹˜", "ê¹€ê·œí—Œ ì°¨ì¥ë‹˜", "ë°•ì¬í˜„ ëŒ€ë¦¬ë‹˜", "ì¡°ì˜ë¹ˆ ëŒ€ë¦¬ë‹˜",
      "ê¹€í˜„ê·œ ëŒ€ë¦¬ë‹˜", "ì¥ì§„ìš° ëŒ€ë¦¬ë‹˜", "ê¹€ë¯¸ì€ ì£¼ì„ë‹˜", "ì´ìˆ˜ì•ˆ ì‚¬ì›ë‹˜", "ë°•ì§€ì•ˆ ì‚¬ì›ë‹˜",
      "ê¹€ì¸ì„  ì‚¬ì›ë‹˜", "ê¹€ìš©ì› ì‚¬ì›ë‹˜", "ìµœì„±ê·œ ì‚¬ì›ë‹˜"
    ];

    /* ---------- ìœ í‹¸ ---------- */
    function showToast(msg) {
      const toast = document.getElementById("toast");
      if (!toast) return;
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 1800);
    }

    function getDeviceLabel() { return localStorage.getItem(DEVICE_KEY) || ""; }
    function setDeviceLabel(label) {
      localStorage.setItem(DEVICE_KEY, label);
      const badgeText = document.getElementById("deviceBadgeText");
      if (badgeText) badgeText.textContent = label || "ê¸°ê¸° ë¯¸ì§€ì •";
    }

    function getTheme() { return localStorage.getItem(THEME_KEY) || "default"; }
    function setTheme
